`一致性哈希算法` 很好地解决了分布式系统在扩容或者缩容时，发生过多的数据迁移的问题

哈希算法是对节点的数量进行取模运算，而一致哈希算法是对 2^32 进行取模运算，是一个固定的值

一致性哈希要进行两步哈希：

- 1.对存储节点进行哈希计算，也就是对存储节点做哈希映射，比如根据节点的 IP 地址进行哈希；
- 2.当对数据进行存储或访问时，对数据进行哈希映射；
  
所以，一致性哈希是指将「存储节点」和「数据」都映射到一个首尾相连的哈希环上。

对指定 key 的值进行读写的时候，要通过下面 2 步进行寻址：

- 对 key 进行哈希计算，确定此 key 在环上的位置；
- 从这个位置沿着顺时针方向走，遇到的第一节点就是存储 key 的节点。

在一致哈希算法中，如果增加或者移除一个节点，仅影响该节点在哈希环上顺时针相邻的后继节点，其它数据也不会受到影响。

一致性哈希算法虽然减少了数据迁移量，但是存在节点分布不均匀的问题。

通过虚拟节点提高均衡度：

不再将真实节点映射到哈希环上，而是将虚拟节点映射到哈希环上，并将虚拟节点映射到实际节点，所以这里有「两层」映射关系。

比如对每个节点分别设置 3 个虚拟节点：

- 对节点 A 加上编号来作为虚拟节点：A-01、A-02、A-03
- 对节点 B 加上编号来作为虚拟节点：B-01、B-02、B-03
- 对节点 C 加上编号来作为虚拟节点：C-01、C-02、C-03

节点数量多了后，节点在哈希环上的分布就相对均匀了。另外，虚拟节点除了会提高节点的均衡度，还会提高系统的稳定性。当节点变化时，会有不同的节点共同分担系统的变化，因此稳定性更高。

带虚拟节点的一致性哈希方法不仅适合硬件配置不同的节点的场景，而且适合节点规模会发生变化的场景。